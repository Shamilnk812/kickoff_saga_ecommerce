{% extends "admin_dash/dash.html" %}
{%load static %}
{% block content %}


<div class="main-panel">
    <div class="content-wrapper">
      <div class="page-header">
        <h4 class="card-title">Offer Management</h4>
        <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="nav-item w-100">
                    <form class="nav-link mt-2 mt-md-0 d-none d-lg-flex search" action="{% url 'view_offers' %}" method="get" >
                      <input type="text" class="form-control" placeholder="Search offer.." name="query" id="query" value="{{ query|default_if_none:'' }}">
                      <button class="btn btn-primary" type="submit">Search</button>
                    </form>
                  </li>
                </ol>
              </nav>       
      </div>
      {% comment %} <div class="row"> {% endcomment %}
        <div class="col-lg-12 grid-margin stretch-card">
          <div class="card">
            {% include "alert.html" %}
            <div class="card-body">
              <a class="btn btn-sm btn-success" style="color : white;" href="{% url 'add_offer' %}">+ Add New Offer</a>
              <a class="btn btn-sm btn-info" style="color : white;" href="{% url 'view_category_offers' %}">Apply Offers for Category</a>
              <a class="btn btn-sm btn-info" style="color : white;" href="{% url 'view_product_offers' %}">Apply Offers for Product</a>
                 <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Id</th>
                      <th>Title</th>
                      <th>Description</th>
                      <th>Ending Date</th>
                      <th>Discount %</th>
                      <th>Status</th>
                      <th>Validity</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% if all_offers%}
                      {% for offer in all_offers%}
                        <tr>
                          <td>{{forloop.counter}}</td>
                          <td>{{offer.title}}</td>
                          <td>{{offer.description }}</td>
                          <td>{{offer.end_date }}</td>
                          <td>{{offer.discount_percentage|stringformat:'d' }} %</td>
                          <td style="color: {% if offer.is_block %}red{% else %}green{% endif %}">
                            {% if offer.is_block%}
                              Inactive
                            {%else%}
                              Active 
                            {%endif%}                            
                          </td>
                          <td style="color: {% if offer.is_valid %}green{% else %}red{% endif %}">
                            {% if offer.is_valid %}
                                Valid
                            {% else %}
                                Expired
                            {% endif %}
                        </td>
                        <td>
                          {% if offer.is_block %}
                                <a data-url="{% url 'delete_offer' offer.id %}"  class="unblock-offer btn btn-sm btn-success" style="color: white;"> Unblock</a>
                          {%else%}
                                <a data-url="{% url 'delete_offer' offer.id %}"  class="block-offer btn btn-sm btn-danger" style="color: white;"> Block</a>
                          {%endif%}
                      </td>  
                   </tr>
                        {%endfor%}   
                    {% else%}
                      <tr>
                        <td colspan="7" class="text-center p-5">No offres added yet .</td>
                      </tr>
                    {% endif%}
                   </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        {% include 'pagination.html' with page_obj=all_offers%}
      </div>
     </div>

  </div>
  </div>



<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const offerLinks = document.querySelectorAll(".block-offer, .unblock-offer");

    offerLinks.forEach(function (link) {
        link.addEventListener("click", function (event) {
            event.preventDefault();

            const url = link.getAttribute("data-url");
            const isBlock = link.classList.contains("block-offer");

            if (isBlock) {
                swal({
                    title: "Are you sure?",
                    text: "Do you want to block this offer?",
                    icon: "warning",
                    buttons: ["Cancel", "Yes, block it"],
                    dangerMode: true,
                }).then((confirmed) => {
                    if (confirmed) {
                        window.location.href = url;
                    }
                });
            } else {
                swal({
                    title: "Are you sure?",
                    text: "Do you want to unblock this offer?",
                    icon: "info",
                    buttons: ["Cancel", "Yes, unblock it"],
                }).then((confirmed) => {
                    if (confirmed) {
                        window.location.href = url;
                    }
                });
            }
        });
    });
});
</script>


{% endblock content %}


